<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Functional processing &mdash; micapipe  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/mica-pipe_colors.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script src="../../_static/tabs.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Microstructural profile covariance" href="../02.microstructproc/index.html" />
    <link rel="prev" title="Diffusion-weighted imaging processing" href="../02.dwiproc/index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #261F4A" >
            <a href="../../index.html">
            <img src="../../_static/html_logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../01.install/index.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../01.whatyouneed/index.html">Usages Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../01.whatsnew/index.html">What‚Äôs new?</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Processing modules</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../02.structuralproc/index.html">Structural processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02.dwiproc/index.html">Diffusion-weighted imaging processing</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">fMRI processing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#proc-func">-proc_func</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../02.microstructproc/index.html">Microstructural profile covariance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02.qc/index.html">Quality control</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02.aslproc/index.html">Arterial spin labeling processing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Additional tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../05.mic2bids/index.html">From DICOMS to BIDS: <code class="docutils literal notranslate"><span class="pre">mic2bids</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../05.micapipe_cleanup/index.html"><code class="docutils literal notranslate"><span class="pre">micapipe_cleanup</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../05.micapipe_anonymize/index.html"><code class="docutils literal notranslate"><span class="pre">micapipe_anonymize</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../05.autotract/index.html">Automatic Bundle Segmentation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../04.start2end/index.html">Processing step by step: start to finish with <code class="docutils literal notranslate"><span class="pre">micapipe</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../04.databases/index.html">Processing databases with <code class="docutils literal notranslate"><span class="pre">micapipe</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../04.matrices/index.html">Main output matrices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../04.surfaces/index.html">Surface visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../04.gradients/index.html">Building gradients</a></li>
<li class="toctree-l1"><a class="reference internal" href="../04.tckdownsample/index.html">How to downsample a tractogram</a></li>
<li class="toctree-l1"><a class="reference internal" href="../04.faq/index.html">FAQ</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">References &amp; Acknowledgements</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../06.citingmicapipe/index.html">Citing micapipe</a></li>
<li class="toctree-l1"><a class="reference internal" href="../06.references/index.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../06.acknowledge/index.html">Acknowledgements</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #261F4A" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">micapipe</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a></li>
      <li class="breadcrumb-item active">Functional processing</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/pages/02.restingstateproc/index.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="fmri-processing">
<span id="restingstateproc"></span><h1>fMRI processing<a class="headerlink" href="#fmri-processing" title="Permalink to this heading">ÔÉÅ</a></h1>
<p>This module performs all pre-processing of a subject‚Äôs task or resting-state functional MRI (fMRI) scans, in preparation for the sampling of regional timeseries and construction of functional connectomes. This pipeline is optimized for spin-echo images with reverse phase encoding used for distortion correction. The pipeline is mainly based on tools from FSL and AFNI for volumetric processing, and FreeSurfer and Workbench for surface-based mapping. For increased functionality, micapipe can also handle protocols in which a single fieldmap is acquired.</p>
<img alt="../../_images/sankey_rsfmri.png" class="align-center" src="../../_images/sankey_rsfmri.png" />
<section id="proc-func">
<h2>-proc_func<a class="headerlink" href="#proc-func" title="Permalink to this heading">ÔÉÅ</a></h2>
<div class="admonition-prerequisites admonition">
<p class="admonition-title">Prerequisites üñêüèº</p>
<p>You need to run <code class="docutils literal notranslate"><span class="pre">-proc_structural</span></code>, <code class="docutils literal notranslate"><span class="pre">-proc_freesurfer</span></code> and <code class="docutils literal notranslate"><span class="pre">-post_structural</span></code> before this stage</p>
</div>
<a class="reference internal image-reference" href="../../_images/proc_rsfmri.png"><img alt="../../_images/proc_rsfmri.png" class="align-center" src="../../_images/proc_rsfmri.png" style="width: 368.9px; height: 876.4px;" /></a>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-0-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-0-0-0" name="0-0" role="tab" tabindex="0">Processing steps</button><button aria-controls="panel-0-0-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-0-0-1" name="0-1" role="tab" tabindex="-1">Usage</button><button aria-controls="panel-0-0-2" aria-selected="false" class="sphinx-tabs-tab" id="tab-0-0-2" name="0-2" role="tab" tabindex="-1">Outputs</button></div><div aria-labelledby="tab-0-0-0" class="sphinx-tabs-panel" id="panel-0-0-0" name="0-0" role="tabpanel" tabindex="0"><ul class="simple">
<li><p>Remove first five TRs (optional, only if flag <code class="docutils literal notranslate"><span class="pre">-dropTR</span></code> is specified)</p></li>
<li><p>Reorient input to LPI</p></li>
<li><p>Perform motion correction within fMRI run and provided fieldmaps by registering each volume to the scan‚Äôs own average</p></li>
<li><p>Calculate motion outliers</p></li>
<li><p>Apply distortion correction to motion-corrected images</p></li>
<li><p>Calculate binary mask from motion and distortion corrected volume</p></li>
<li><p>High-pass filtering of functional timeseries to remove frequencies below 0.01Hz</p></li>
<li><p>Run Multivariate Exploratory Linear Optimized Decomposition into Independent Components (MELODIC) on filtered timeseries</p></li>
<li><p>Compute linear and non-linear registrations between fMRI and T1-nativepro space, as well as boundary-based registration between fMRI and native Freesurfer space</p></li>
<li><p>Run FMRIB‚Äôs ICA-based Xnoiseifier (ICA-FIX) using specified training file. Note that if ICA-FIX is not found on the user‚Äôs system, or if MELODIC failed, ICA-FIX will be skipped and further processing will be performed using high-pass filtered timeseries</p></li>
<li><p>Extract global and tissue-specific signal (cerebrospinal fluid, white matter, and gray matter) from processed timeseries</p></li>
<li><p>Calculate and save motion confounds matrix from processed timeseries</p></li>
<li><p>Register processed timeseries to the native cortical surface. Minimially pre-processed (i.e. motion and distortion corrected) timeseries are also registered to the native cortical surface to compute statistics such as temporal signal-to-noise</p></li>
<li><p>Surface-based registration of native surface timeseries to surface templates (fsaverage5, conte69)</p></li>
<li><p>Native surface, fsaverage5, and conte69-mapped timeseries are each smoothed with a 10mm Gaussian kernel</p></li>
<li><p>Use previously computed registrations to align cerebellar and subcortical parcellations to fMRI space</p></li>
<li><p>Concatenate cerebellar, subcortical, and parcellated cortical timeseries</p></li>
<li><p>Regress motion spikes from cerebellar, subcortical, and cortical timeseries in linear model. If specified using optional flags, regression of tissue-specific signals and six motion confounds (<code class="docutils literal notranslate"><span class="pre">-NSR</span></code>) and global signal (<code class="docutils literal notranslate"><span class="pre">-GSR</span></code>) will also be performed. Following this step, timeseries are saved in two formats: (1) cerebellar regions, subcortical regions, and vertexwise cortical timeseries (conte69), and (2) cerebellar regions, subcortical regions, and parcellated cortical regions.</p></li>
<li><p>Cross-correlate functional signals across all parcellated regions and output correlation matrix. If flag <code class="docutils literal notranslate"><span class="pre">-noFC</span></code> is specified, this step will be skipped.</p></li>
</ul>
</div><div aria-labelledby="tab-0-0-1" class="sphinx-tabs-panel" hidden="true" id="panel-0-0-1" name="0-1" role="tabpanel" tabindex="0"><p><strong>Terminal:</strong></p>
<pre class="literal-block">$ mica-pipe <strong>-sub</strong> &lt;subject_id&gt; <strong>-out</strong> &lt;outputDirectory&gt; <strong>-bids</strong> &lt;BIDS-directory&gt; <strong>-proc_func</strong></pre>
<p><strong>Docker command:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ docker -proc_func
</pre></div>
</div>
<div class="admonition-deprecated admonition">
<p class="admonition-title">Deprecated ‚ùå</p>
<p>Note that the flag <code class="docutils literal notranslate"><span class="pre">proc_rsfmri</span></code> is deprecated and has been replaced by <code class="docutils literal notranslate"><span class="pre">-proc_func</span></code>.</p>
</div>
<p><strong>Optional arguments:</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">-proc_func</span></code> has several optional arguments:</p>
<table class="colwidths-given tight-table docutils align-default">
<colgroup>
<col style="width: 9%" />
<col style="width: 91%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Optional argument</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-mainScanStr</span></code> <code class="docutils literal notranslate"><span class="pre">&lt;str&gt;</span></code></p></td>
<td><p>String to manually identify the main scan for functional processing (eg. <em>func/sub-001_&lt;mainScanStr&gt;.nii.gz</em>). Default string is <em>task-rest_acq-AP_bold</em>.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">-func_pe</span></code> <code class="docutils literal notranslate"><span class="pre">&lt;path&gt;</span></code></p></td>
<td><p>Full path to the main phase encoding scan for functional processing. Default string is <em>task-rest_acq-APse_bold</em>.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-func_rpe</span></code> <code class="docutils literal notranslate"><span class="pre">&lt;path&gt;</span></code></p></td>
<td><p>Full path to the reverse phase encoding scan for functional processing. If the path is wrong topup will be skipped! Default string is <em>task-rest_acq-PAse_bold</em>.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">-mainScanRun</span></code> <code class="docutils literal notranslate"><span class="pre">&lt;num&gt;</span></code></p></td>
<td><p>If multiple runs of a functional scan with the same identifier exist in the BIDS rawdata, you must specify which scan to process using this flag (e.g. ‚Äò1‚Äô).</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-phaseReversalRun</span></code> <code class="docutils literal notranslate"><span class="pre">&lt;num&gt;</span></code></p></td>
<td><p>If multiple phase encoding runs exist in the BIDS directory (only main phase is checked), you must specify which file to process using this flag (e.g. ‚Äò1‚Äô).</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">-topupConfig</span></code> <code class="docutils literal notranslate"><span class="pre">&lt;path&gt;</span></code></p></td>
<td><p>Specify path to config file that should be used for distortion correction using topup. Default is <em>${FSLDIR}/etc/flirtsch/b02b0_1.cnf</em>.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-smoothWithWB</span></code></p></td>
<td><p>Specify this option to use workbench tools for surface-based smoothing (more memory intensive). By default, smoothing is performed with freesurfer tools: <em>mri_surf2surf</em>.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">-NSR</span></code></p></td>
<td><p>Specify this option to perform nuisance signal regression, which includes six motion parameters, white matter signal, and CSF signal. By default, this option is set to FALSE (no nuisance signal regression).</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-GSR</span></code></p></td>
<td><p>Specify this option to perform global signal regression of timeseries. By default, no global regression is performed.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">-noFIX</span></code></p></td>
<td><p>Specify this option to skip ICA-FIX processing. By default, FIX will run with the default training file.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-icafixTraining</span></code> <code class="docutils literal notranslate"><span class="pre">&lt;path&gt;</span></code></p></td>
<td><p>Path to specified ICA-FIX training file for nuisance signal regression (file.RData). Default is <em>${MICAPIPE}/functions/MICAMTL_training_15HC_15PX.RData</em>.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">-sesAnat</span></code> <code class="docutils literal notranslate"><span class="pre">&lt;str&gt;</span></code></p></td>
<td><p>If longitudinal data is provided, this flag allows to register the current <em>functional</em> session to the desired <em>anatomical</em> session</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-regAffine</span></code></p></td>
<td><p>Specify this option to perform an affine registration ONLY from functional to T1w. By default, functional processing in micapipe performs a non linear registration using ANTs-SyN. We recommend this option for functional acquisitions with low resolution and/or low SNR.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">-dropTR</span></code></p></td>
<td><p>Specify this option to drop the first five TRs. By default, this option is set to FALSE (all TRs will be processed)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-noFC</span></code></p></td>
<td><p>Specify this option to skip the computation of functional connectomes (for example when processing task fMRI data). By default, this option is set to FALSE (functional connectomes are output by default).</p></td>
</tr>
</tbody>
</table>
<div class="admonition-distortion-correction admonition">
<p class="admonition-title">Distortion correction ‚úÖ</p>
<p>If the script can‚Äôt find the <em>func_rpe</em> (reverse phase encoding), or <em>func_pe</em> (phase encoding) images, distortion correction will be skipped. If you provide the path to the <em>func_pe</em> and <em>func_rpe</em> images, make sure the paths are correct! The possible scenarios and conditions in which topup is run (or skipped) are presented in the table below:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 23%" />
<col style="width: 21%" />
<col style="width: 56%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="2"><p>Inputs</p></th>
<th class="head"><p>Output</p></th>
</tr>
<tr class="row-even"><th class="head"><p>fmri_rpe</p></th>
<th class="head"><p>fmri_pe</p></th>
<th class="head"><p>topup</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>Yes</p></td>
<td><p>Yes</p></td>
<td><p>runs using pe and rpe</p></td>
</tr>
<tr class="row-even"><td><p>Yes</p></td>
<td><p>No</p></td>
<td><p>runs using main as pe</p></td>
</tr>
<tr class="row-odd"><td><p>No</p></td>
<td><p>No</p></td>
<td><p>skipped</p></td>
</tr>
</tbody>
</table>
</div>
<div class="admonition-notes-on-ica-melodic-and-ica-fix admonition">
<p class="admonition-title">Notes on ICA-Melodic and ICA-FIX üõÅ</p>
<p>FIX and Melodic are used by default to remove nuisance variable signal. However, our default parameters might not suit all databases. Our default training file used for FIX was trained on resting-state fMRI data from 30 participants (15 healthy controls, 15 patients with drug-resistant epilepsy). Scans were acquired on a 3T Siemens Magnetom Prisma-Fit equipped with a 64-channel head coil. rs-fMRI scans of 7 minutes were acquired using multiband accelerated 2D-BOLD echo-planar imaging (3mm isotropic voxels, TR=600ms, TE=30ms, flip angle=52¬∞, FOV=240√ó240mm2, slice thickness=3mm, mb factor=6, echo spacing=0.54ms). If your acquisition parameters are similar to this, it may be appropriate for you to use the defaults options in <code class="docutils literal notranslate"><span class="pre">-proc_func</span></code>. Otherwise, if your acquisition parameters are drastically different, we recommend that you <a class="reference external" href="https://fsl.fmrib.ox.ac.uk/fsl/fslwiki/FIX/UserGuide#Training_datasets">train your own dataset for FIX</a>, or do not use FIX and try a different method for nuisance variable signal removal. In the next example, FIX and Melodic will be skipped, but global signal, white matter and CSF regressions will be applied:</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">Example</span><a class="headerlink" href="#id1" title="Permalink to this code">ÔÉÅ</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>mica-pipe -sub &lt;subject_id&gt; -out &lt;outputDirectory&gt; -bids &lt;BIDS-directory&gt; <span class="se">\</span>
<span class="linenos">2</span>          -proc_func -noFIX -NSR -GSR
</pre></div>
</div>
</div>
</div>
<div class="admonition-longitudinal-acquisitions admonition">
<p class="admonition-title">Longitudinal acquisitions üë∂ üë¶ üë® üë®‚Äçü¶≥</p>
<p>If your database contains multiple sessions (different days) and you wish to register the functional scan to the same
anatomical session, you should use the <code class="docutils literal notranslate"><span class="pre">-sesAnat</span></code> flag. For example if you database looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sub-01
‚îú‚îÄ‚îÄ ses-func01
‚îÇ¬†¬† ‚îî‚îÄ‚îÄ func
‚îú‚îÄ‚îÄ ses-func02
‚îÇ¬†¬† ‚îî‚îÄ‚îÄ func
‚îî‚îÄ‚îÄ ses-struct01
 ¬†¬† ‚îî‚îÄ‚îÄ anat
</pre></div>
</div>
<p>You should specify <code class="docutils literal notranslate"><span class="pre">-sesAnat</span></code> <code class="docutils literal notranslate"><span class="pre">struct01</span></code> to register each session to the same anatomical volume. In the next example, sessions <code class="docutils literal notranslate"><span class="pre">func01</span></code> and <code class="docutils literal notranslate"><span class="pre">func02</span></code> will be registered to the anatomical image in <code class="docutils literal notranslate"><span class="pre">struct01</span></code>:</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">Example</span><a class="headerlink" href="#id2" title="Permalink to this code">ÔÉÅ</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span> mica-pipe -sub <span class="m">01</span> -ses func01 -proc_func -sesAnat struct01 -bids &lt;bidsDir&gt; -out &lt;outDir&gt;
<span class="linenos">2</span> mica-pipe -sub <span class="m">01</span> -ses func02 -proc_func -sesAnat struct01 -bids &lt;bidsDir&gt; -out &lt;outDir&gt;
</pre></div>
</div>
</div>
</div>
</div><div aria-labelledby="tab-0-0-2" class="sphinx-tabs-panel" hidden="true" id="panel-0-0-2" name="0-2" role="tabpanel" tabindex="0"><p>Directories created or populated by <strong>-proc_func</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="o">&lt;</span><span class="n">outputDirectory</span><span class="o">&gt;/</span><span class="n">micapipe</span><span class="o">/</span><span class="n">func</span><span class="o">/&lt;</span><span class="n">mainScanStr</span><span class="o">&gt;</span>
<span class="o">-</span> <span class="o">&lt;</span><span class="n">outputDirectory</span><span class="o">&gt;/</span><span class="n">micapipe</span><span class="o">/</span><span class="n">func</span><span class="o">/&lt;</span><span class="n">mainScanStr</span><span class="o">&gt;/</span><span class="n">surfaces</span>
<span class="o">-</span> <span class="o">&lt;</span><span class="n">outputDirectory</span><span class="o">&gt;/</span><span class="n">micapipe</span><span class="o">/</span><span class="n">func</span><span class="o">/&lt;</span><span class="n">mainScanStr</span><span class="o">&gt;/</span><span class="n">volumetric</span>
<span class="o">-</span> <span class="o">&lt;</span><span class="n">outputDirectory</span><span class="o">&gt;/</span><span class="n">micapipe</span><span class="o">/</span><span class="n">xfms</span>
</pre></div>
</div>
<p>Files generated by <strong>-proc_func</strong>:</p>
<pre class="literal-block">- All volumetric processing outputs are stored in
    <em>&lt;outputDirectory&gt;/micapipe/func/&lt;mainScanStr&gt;/volumetric</em>

    - functional MRI processing json card:
        <em>&lt;sub&gt;_space-func_desc-se_clean.json</em>

    - Motion confounds processing (&lt;tag&gt; = reversePhaseScan, mainPhaseScan):
        <em>&lt;sub&gt;_space-func_desc-se_&lt;tag&gt;.1D</em>

    - Motion outliers and metric values:
        <em>&lt;sub&gt;_space-func_desc-se_metric_FD.1D</em>
        <em>&lt;sub&gt;_space-func_desc-se_spikeRegressors_FD.1D</em>

    - Motion and distortion corrected image:
        <em>&lt;sub&gt;_space-func_desc-se.nii.gz</em>

    - Mean motion and distortion corrected image:
        <em>&lt;sub&gt;_space-func_desc-se_mean.nii.gz</em>

    - Skull-stipped mean motion and distortion corrected image:
        <em>&lt;sub&gt;_space-func_desc-se_brain.nii.gz</em>

    - High-pass filtered, motion and distortion corrected image:
        <em>&lt;sub&gt;_space-func_desc-se_HP.nii.gz</em>

    - Nuisance-signal regressed timeseries (i.e. output of ICA-FIX) and corresponding json card:
        <em>&lt;sub&gt;_space-func_desc-se_clean.nii.gz</em>
        <em>&lt;sub&gt;_space-func_desc-se_clean.json</em>

    - Tissue-specific mean signal (&lt;tissue&gt; = CSF, GM, or WM):
        <em>&lt;sub&gt;_space-func_desc-se_pve_&lt;tissue&gt;.txt</em>

    - Global mean signal:
        <em>&lt;sub&gt;_space-func_desc-se_pve_global.txt</em>

    - Motion outliers and metric values used for motion parameter regression:
        <em>&lt;sub&gt;_space-func_desc-se_metric_REFMSE.1D</em>
        <em>&lt;sub&gt;_space-func_desc-se_spikeRegressors_REFMSE.1D</em>

    - Subcortical segmentation in fMRI space:
        <em>&lt;sub&gt;_space-func_desc-se_subcortical.nii.gz</em>

    - Mean signal in each subcortical parcel:
        <em>&lt;sub&gt;_space-func_desc-se_timeseries_subcortical.txt</em>

    - Cerebellar segmentation in fMRI space:
        <em>&lt;sub&gt;_space-func_desc-se_cerebellum.nii.gz</em>

    - Mean signal in each cerebellar parcel:
        <em>&lt;sub&gt;_space-func_desc-se_timeseries_cerebellum.txt</em>

    - Parcel statistics for cerebellum, to screen for any missing parcels:
        <em>&lt;sub&gt;_space-func_desc-se_cerebellum_roi_stats.txt</em>


- All surface-based metrucs including vertexwise cortical timeseries (&lt;hemi&gt; = rh, lh) are stored in
<em>&lt;outputDirectory&gt;/micapipe/func/&lt;mainScanStr&gt;/surfaces</em>:

    - Motion and distortion corrected timeseries mapped to native cortical surface:
        <em>&lt;sub&gt;_func_space-fsnative_&lt;hemi&gt;_NoHP.mgh</em>

    - Fully pre-processed timeseries mapped to native cortical surface:
        <em>&lt;sub&gt;_func_space-fsnative_&lt;hemi&gt;.mgh</em>
        <em>&lt;sub&gt;_func_space-fsnative_&lt;hemi&gt;_10mm.mgh</em>

    - Timeseries mapped to fsaverage5 template:
        <em>&lt;sub&gt;_func_space-fsaverage5_&lt;hemi&gt;.mgh</em>
        <em>&lt;sub&gt;_func_space-fsaverage5_&lt;hemi&gt;_10mm.mgh</em>

    - Timeseries mapped to conte69 template:
        <em>&lt;sub&gt;_func_space-conte69-32k_&lt;hemi&gt;.mgh</em>
        <em>&lt;sub&gt;_func_space-conte69-32k_&lt;hemi&gt;_10mm.mgh</em>

    - Vertexwise and smoothed timeseries on conte69 template, following regression of specified nuisance variables:
        <em>&lt;sub&gt;_func_space-conte69-32k_desc-timeseries_clean.txt</em>

- Temporal signal-to-noise ratio computed on native cortical surface from motion and distortion correction timeseries:
    <em>&lt;sub&gt;_space-func_desc-se_tSNR.txt</em>

- Functional connectome matrices (r-values) generated from smoothed, parcellated timeseries sampled in subcortex, cerebellum, and cortical surface
   &lt;parc&gt; = up to 18 parcellations

    - Conte69 cortical surface:
        <em>&lt;sub&gt;_func_space-conte69-32k_atlas-&lt;parc&gt;_desc-FC.txt</em>

    - Native cortical surface:
        <em>&lt;sub&gt;_func_space-fsnative_atlas-&lt;parc&gt;_desc-FC.txt</em>

    - Contatenated timeseries sampled in subcortex, cerebellum, and parcellated native cortical surface models:
        <em>&lt;sub&gt;_func_space-fsnative_atlas-&lt;parc&gt;_desc-timeseries.txt</em>

- Registration files to functional imaging space are found in <em>&lt;outputDirectory&gt;/micapipe/&lt;sub&gt;/xfms</em>

    - Boundary based registration from functional space to native freesurfer space:
        <em>&lt;sub&gt;_from-&lt;mainScanStr&gt;_to-fsnative_bbr_outbbreg_FIX.nii.gz</em>
        <em>&lt;sub&gt;_from-&lt;mainScanStr&gt;_to-fsnative_bbr.dat</em>
        <em>&lt;sub&gt;_from-&lt;mainScanStr&gt;_to-fsnative_bbr.dat.log</em>
        <em>&lt;sub&gt;_from-&lt;mainScanStr&gt;_to-fsnative_bbr.dat.mincost</em>
        <em>&lt;sub&gt;_from-&lt;mainScanStr&gt;_to-fsnative_bbr.dat.param</em>
        <em>&lt;sub&gt;_from-&lt;mainScanStr&gt;_to-fsnative_bbr.dat.sum</em>

    - Affine registration between T1w nativepro and functional space:
        <em>&lt;sub&gt;_from-&lt;mainScanStr&gt;_to-nativepro_mode-image_desc-affine_0GenericAffine.mat</em>
        <em>&lt;sub&gt;_from-&lt;mainScanStr&gt;_to-nativepro_mode-image_desc-affine_InverseWarped.nii.gz</em>
        <em>&lt;sub&gt;_from-&lt;mainScanStr&gt;_to-nativepro_mode-image_desc-affine_Warped.nii.gz</em>

    - Non-linear registrations between T1w in dwi space to wmNorm in dwi space:
        <em>&lt;sub&gt;_from-nativepro_to-&lt;mainScanStr&gt;_mode-image_desc-SyN_0GenericAffine.mat</em>
        <em>&lt;sub&gt;_from-nativepro_to-&lt;mainScanStr&gt;_mode-image_desc-SyN_1InverseWarp.nii.gz</em>
        <em>&lt;sub&gt;_from-nativepro_to-&lt;mainScanStr&gt;_mode-image_desc-SyN_1Warp.nii.gz</em>
        <em>&lt;sub&gt;_from-nativepro_to-&lt;mainScanStr&gt;_mode-image_desc-SyN_InverseWarped.nii.gz</em>
        <em>&lt;sub&gt;_from-nativepro_to-&lt;mainScanStr&gt;_mode-image_desc-SyN_Warped.nii.gz</em></pre>
</div></div>
</section>
</section>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../02.microstructproc/index.html" class="btn btn-neutral float-right" title="Microstructural profile covariance" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../02.dwiproc/index.html" class="btn btn-neutral float-left" title="Diffusion-weighted imaging processing" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2022, micapipe

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a 
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a> and modified by SL and RRC 

</footer>

        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>  

  <style>
         .wy-nav-content { max-width: none; }
  </style>


  <footer>
    
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a 
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. Modified by SL ü§† 

  </footer>



</body>
</html>