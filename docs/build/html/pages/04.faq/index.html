<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Frequent Asked Questions &mdash; micapipe  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/mica-pipe_colors.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Citing micapipe" href="../06.citingmicapipe/index.html" />
    <link rel="prev" title="How to downsample a tractogram" href="../04.tckdownsample/index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #261F4A" >
            <a href="../../index.html">
            <img src="../../_static/html_logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../01.install/index.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../01.whatyouneed/index.html">Usages Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../01.whatsnew/index.html">What’s new?</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Processing modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../02.structuralproc/index.html">Structural processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02.dwiproc/index.html">Diffusion-weighted imaging processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02.restingstateproc/index.html">fMRI processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02.microstructproc/index.html">Microstructural profile covariance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02.qc/index.html">Quality control</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02.aslproc/index.html">Arterial spin labeling processing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Additional tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../05.mic2bids/index.html">From DICOMS to BIDS: <code class="docutils literal notranslate"><span class="pre">mic2bids</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../05.micapipe_cleanup/index.html"><code class="docutils literal notranslate"><span class="pre">micapipe_cleanup</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../05.micapipe_anonymize/index.html"><code class="docutils literal notranslate"><span class="pre">micapipe_anonymize</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../05.autotract/index.html">Automatic Bundle Segmentation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../04.start2end/index.html">Processing step by step: start to finish with <code class="docutils literal notranslate"><span class="pre">micapipe</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../04.databases/index.html">Processing databases with <code class="docutils literal notranslate"><span class="pre">micapipe</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../04.matrices/index.html">Main output matrices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../04.surfaces/index.html">Surface visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../04.gradients/index.html">Building gradients</a></li>
<li class="toctree-l1"><a class="reference internal" href="../04.tckdownsample/index.html">How to downsample a tractogram</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">FAQ</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#registration-issues">Registration issues</a></li>
<li class="toctree-l2"><a class="reference internal" href="#surface-issues">Surface issues</a></li>
<li class="toctree-l2"><a class="reference internal" href="#resting-state-issues">Resting state issues</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dwi-issues">DWI issues</a></li>
<li class="toctree-l2"><a class="reference internal" href="#parcellation-issues">Parcellation issues</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">References &amp; Acknowledgements</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../06.citingmicapipe/index.html">Citing micapipe</a></li>
<li class="toctree-l1"><a class="reference internal" href="../06.references/index.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../06.acknowledge/index.html">Acknowledgements</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #261F4A" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">micapipe</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a></li>
      <li class="breadcrumb-item active">Frequent Asked Questions</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/pages/04.faq/index.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="faq">
<span id="faqa"></span><h1><a class="toc-backref" href="#id11">FAQ</a><a class="headerlink" href="#faq" title="Permalink to this heading"></a></h1>
<div class="contents topic" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#faq" id="id11">FAQ</a></p>
<ul>
<li><p><a class="reference internal" href="#registration-issues" id="id12">Registration issues</a></p></li>
<li><p><a class="reference internal" href="#surface-issues" id="id13">Surface issues</a></p></li>
<li><p><a class="reference internal" href="#resting-state-issues" id="id14">Resting state issues</a></p></li>
<li><p><a class="reference internal" href="#dwi-issues" id="id15">DWI issues</a></p></li>
<li><p><a class="reference internal" href="#parcellation-issues" id="id16">Parcellation issues</a></p></li>
</ul>
</li>
</ul>
</div>
<section id="registration-issues">
<h2><a class="toc-backref" href="#id12">Registration issues</a><a class="headerlink" href="#registration-issues" title="Permalink to this heading"></a></h2>
<dl>
<dt>Q: How do I register a volume from rsfMRI or DWI space to MNI152 and vice-versa?</dt><dd><p><strong>A:</strong> although micapipe calculates all the necessary transformation matrices and warp fields to register from any native space to MNI152,
this procedure is not implemented at any point in the pipeline.</p>
<p>Using the following information you should be able to register between any spaces using ANTs.
The paths are relative to the subject directory (e.g. <code class="docutils literal notranslate"><span class="pre">out/micapipe/sub-01/ses-01</span></code>)</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">Map from MNI152 0.8mm space to DWI native space</span><a class="headerlink" href="#id1" title="Permalink to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1"># Subjects identification</span>
<span class="linenos"> 2</span><span class="nv">subjectID</span><span class="o">=</span>sub-01_ses-01
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="c1"># Map from MNI152 0.8mm to DWI space</span>
<span class="linenos"> 5</span><span class="nv">Input</span><span class="o">=</span>file_in_space-MNI152_0.8mm.nii.gz
<span class="linenos"> 6</span><span class="nv">Output</span><span class="o">=</span>file_from_MNI152_0.8mm_in_space-dwi.nii.gz
<span class="linenos"> 7</span>
<span class="linenos"> 8</span>antsApplyTransforms -d <span class="m">3</span> -i <span class="si">${</span><span class="nv">Input</span><span class="si">}</span> <span class="se">\</span>
<span class="linenos"> 9</span>          -r dwi/<span class="si">${</span><span class="nv">subjectID</span><span class="si">}</span>_space-dwi_desc-b0.nii.gz <span class="se">\</span>
<span class="linenos">10</span>          -n GenericLabel <span class="se">\ </span>  <span class="c1"># Interpolation!</span>
<span class="linenos">11</span>          -t xfm/<span class="si">${</span><span class="nv">subjectID</span><span class="si">}</span>_space-dwi_from-dwi_to-dwi_mode-image_desc-SyN_1Warp.nii.gz <span class="se">\</span>
<span class="linenos">12</span>          -t xfm/<span class="si">${</span><span class="nv">subjectID</span><span class="si">}</span>_space-dwi_from-dwi_to-dwi_mode-image_desc-SyN_0GenericAffine.mat <span class="se">\</span>
<span class="linenos">13</span>          -t <span class="o">[</span>xfm/<span class="si">${</span><span class="nv">subjectID</span><span class="si">}</span>_space-dwi_from-dwi_to-nativepro_mode-image_desc-0GenericAffine.mat,1<span class="o">]</span> <span class="se">\</span>
<span class="linenos">14</span>          -t <span class="o">[</span>xfm/<span class="si">${</span><span class="nv">subjectID</span><span class="si">}</span>_from-nativepro_brain_to-MNI152_0.8mm_mode-image_desc-SyN_0GenericAffine.mat,1<span class="o">]</span> <span class="se">\</span>
<span class="linenos">15</span>          -t xfm/<span class="si">${</span><span class="nv">subjectID</span><span class="si">}</span>_from-nativepro_brain_to-MNI152_0.8mm_mode-image_desc-SyN_1InverseWarp.nii.gz <span class="se">\</span>
<span class="linenos">16</span>          -o <span class="si">${</span><span class="nv">Output</span><span class="si">}</span> -v
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">Map from DWI native space to MNI152 0.8mm</span><a class="headerlink" href="#id2" title="Permalink to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1"># Map from DWI space to MNI152 0.8mm</span>
<span class="linenos"> 2</span><span class="nv">Input</span><span class="o">=</span>file_in_space-dwi.nii.gz
<span class="linenos"> 3</span><span class="nv">Output</span><span class="o">=</span>file_from_dwi_in_space-MNI152_0.8mm.nii.gz
<span class="linenos"> 4</span>
<span class="linenos"> 5</span>antsApplyTransforms -d <span class="m">3</span> -i <span class="si">${</span><span class="nv">Input</span><span class="si">}</span> <span class="se">\</span>
<span class="linenos"> 6</span>          -r <span class="si">${</span><span class="nv">MICAPIPE_DIR</span><span class="si">}</span>/MNI152Volumes/MNI152_T1_0.8mm_brain.nii.gz <span class="se">\</span>
<span class="linenos"> 7</span>          -n GenericLabel <span class="se">\</span>
<span class="linenos"> 8</span>          -t xfm/<span class="si">${</span><span class="nv">subjectID</span><span class="si">}</span>_from-nativepro_brain_to-MNI152_0.8mm_mode-image_desc-SyN_1Warp.nii.gz <span class="se">\</span>
<span class="linenos"> 9</span>          -t xfm/<span class="si">${</span><span class="nv">subjectID</span><span class="si">}</span>_from-nativepro_brain_to-MNI152_0.8mm_mode-image_desc-SyN_0GenericAffine.mat <span class="se">\</span>
<span class="linenos">10</span>          -t xfm/<span class="si">${</span><span class="nv">subjectID</span><span class="si">}</span>_space-dwi_from-dwi_to-nativepro_mode-image_desc-0GenericAffine.mat <span class="se">\</span>
<span class="linenos">11</span>          -t <span class="o">[</span>xfm/<span class="si">${</span><span class="nv">subjectID</span><span class="si">}</span>_space-dwi_from-dwi_to-dwi_mode-image_desc-SyN_0GenericAffine.mat,1<span class="o">]</span> <span class="se">\</span>
<span class="linenos">12</span>          -t xfm/<span class="si">${</span><span class="nv">subjectID</span><span class="si">}</span>_space-dwi_from-dwi_to-dwi_mode-image_desc-SyN_1Warp.nii.gz <span class="se">\</span>
<span class="linenos">13</span>          -o <span class="si">${</span><span class="nv">Output</span><span class="si">}</span> -v
<span class="linenos">14</span><span class="o">}</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">From MNI152 to rsfMRI space</span><a class="headerlink" href="#id3" title="Permalink to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1"># Map from MNI152 0.8mm to rsfMRI space</span>
<span class="linenos"> 2</span><span class="nv">Input</span><span class="o">=</span>file_in_space-MNI152_0.8mm.nii.gz
<span class="linenos"> 3</span><span class="nv">Output</span><span class="o">=</span>file_from_MNI152_0.8mm_in_space-rsfMRI.nii.gz
<span class="linenos"> 4</span>
<span class="linenos"> 5</span>antsApplyTransforms -d <span class="m">3</span> <span class="se">\</span>
<span class="linenos"> 6</span>    -i <span class="si">${</span><span class="nv">Input</span><span class="si">}</span> <span class="se">\</span>
<span class="linenos"> 7</span>    -r func/volumetric/<span class="si">${</span><span class="nv">subjectID</span><span class="si">}</span>_space-rsfmri_desc-singleecho_brain.nii.gz <span class="se">\</span>
<span class="linenos"> 8</span>    -t xfm/<span class="si">${</span><span class="nv">subjectID</span><span class="si">}</span>_rsfmri_from-nativepro_rsfmri_to-rsfmri_mode-image_desc-SyN_1Warp.nii.gz <span class="se">\</span>
<span class="linenos"> 9</span>    -t xfm/<span class="si">${</span><span class="nv">subjectID</span><span class="si">}</span>_rsfmri_from-nativepro_rsfmri_to-rsfmri_mode-image_desc-SyN_0GenericAffine.mat <span class="se">\</span>
<span class="linenos">10</span>    -t <span class="o">[</span>xfm/<span class="si">${</span><span class="nv">subjectID</span><span class="si">}</span>_rsfmri_from-rsfmri_to-nativepro_mode-image_desc-affine_0GenericAffine.mat,1<span class="o">]</span> <span class="se">\</span>
<span class="linenos">11</span>    -t <span class="o">[</span>xfm/<span class="si">${</span><span class="nv">subjectID</span><span class="si">}</span>_from-nativepro_brain_to-MNI152_0.8mm_mode-image_desc-SyN_0GenericAffine.mat,1<span class="o">]</span> <span class="se">\</span>
<span class="linenos">12</span>    -t xfm/<span class="si">${</span><span class="nv">subjectID</span><span class="si">}</span>_from-nativepro_brain_to-MNI152_0.8mm_mode-image_desc-SyN_1InverseWarp.nii.gz <span class="se">\</span>
<span class="linenos">13</span>    -o <span class="si">${</span><span class="nv">Output</span><span class="si">}</span> -v
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">From rsfMRI to MNI152 space</span><a class="headerlink" href="#id4" title="Permalink to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1"># Map from rsfMRI space to MNI152 0.8mm</span>
<span class="linenos"> 2</span><span class="nv">Input</span><span class="o">=</span>file_in_space-rsfMRI.nii.gz
<span class="linenos"> 3</span><span class="nv">Output</span><span class="o">=</span>file_from_rsfMRI_in_space-MNI152_0.8mm.nii.gz
<span class="linenos"> 4</span>
<span class="linenos"> 5</span>antsApplyTransforms -d <span class="m">3</span> <span class="se">\</span>
<span class="linenos"> 6</span>    -i func/volumetric/<span class="si">${</span><span class="nv">subjectID</span><span class="si">}</span>_space-rsfmri_desc-singleecho_brain.nii.gz <span class="se">\</span>
<span class="linenos"> 7</span>    -r <span class="si">${</span><span class="nv">MICAPIPE_DIR</span><span class="si">}</span>/MNI152Volumes/MNI152_T1_0.8mm_brain.nii.gz <span class="se">\</span>
<span class="linenos"> 8</span>    -t xfm/<span class="si">${</span><span class="nv">subjectID</span><span class="si">}</span>_from-nativepro_brain_to-MNI152_0.8mm_mode-image_desc-SyN_1Warp.nii.gz <span class="se">\</span>
<span class="linenos"> 9</span>    -t xfm/<span class="si">${</span><span class="nv">subjectID</span><span class="si">}</span>_from-nativepro_brain_to-MNI152_0.8mm_mode-image_desc-SyN_0GenericAffine.mat <span class="se">\</span>
<span class="linenos">10</span>    -t xfm/<span class="si">${</span><span class="nv">subjectID</span><span class="si">}</span>_rsfmri_from-rsfmri_to-nativepro_mode-image_desc-affine_0GenericAffine.mat <span class="se">\</span>
<span class="linenos">11</span>    -t <span class="o">[</span>xfm/<span class="si">${</span><span class="nv">subjectID</span><span class="si">}</span>_rsfmri_from-nativepro_rsfmri_to-rsfmri_mode-image_desc-SyN_0GenericAffine.mat,1<span class="o">]</span> <span class="se">\</span>
<span class="linenos">12</span>    -t xfm/<span class="si">${</span><span class="nv">subjectID</span><span class="si">}</span>_rsfmri_from-nativepro_rsfmri_to-rsfmri_mode-image_desc-SyN_1InverseWarp.nii.gz <span class="se">\</span>
<span class="linenos">13</span>    -o <span class="si">${</span><span class="nv">Output</span><span class="si">}</span> -v -u int
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">From rsfMRI to nativepro space</span><a class="headerlink" href="#id5" title="Permalink to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1"># Map from rsfMRI space to nativepro 2mm</span>
<span class="linenos"> 2</span><span class="nv">Input</span><span class="o">=</span>file_in_space-rsfMRI.nii.gz
<span class="linenos"> 3</span><span class="nv">Output</span><span class="o">=</span>file_from_rsfMRI_in_space-nativepro_2mm.nii.gz
<span class="linenos"> 4</span>
<span class="linenos"> 5</span>antsApplyTransforms -d <span class="m">3</span> <span class="se">\</span>
<span class="linenos"> 6</span>    -i func/volumetric/<span class="si">${</span><span class="nv">subjectID</span><span class="si">}</span>_space-rsfmri_desc-singleecho_brain.nii.gz <span class="se">\</span>
<span class="linenos"> 7</span>    -r <span class="si">${</span><span class="nv">MICAPIPE_DIR</span><span class="si">}</span>/MNI152Volumes/MNI152_T1_2mm_brain.nii.gz <span class="se">\</span>
<span class="linenos"> 8</span>    -t xfm/<span class="si">${</span><span class="nv">subjectID</span><span class="si">}</span>_rsfmri_from-rsfmri_to-nativepro_mode-image_desc-affine_0GenericAffine.mat <span class="se">\</span>
<span class="linenos"> 9</span>    -t <span class="o">[</span>xfm/<span class="si">${</span><span class="nv">subjectID</span><span class="si">}</span>_rsfmri_from-nativepro_rsfmri_to-rsfmri_mode-image_desc-SyN_0GenericAffine.mat,1<span class="o">]</span> <span class="se">\</span>
<span class="linenos">10</span>    -t xfm/<span class="si">${</span><span class="nv">subjectID</span><span class="si">}</span>_rsfmri_from-nativepro_rsfmri_to-rsfmri_mode-image_desc-SyN_1InverseWarp.nii.gz <span class="se">\</span>
<span class="linenos">11</span>    -o <span class="si">${</span><span class="nv">Output</span><span class="si">}</span> -v -u int
</pre></div>
</div>
</div>
</dd>
</dl>
</section>
<section id="surface-issues">
<h2><a class="toc-backref" href="#id13">Surface issues</a><a class="headerlink" href="#surface-issues" title="Permalink to this heading"></a></h2>
<dl>
<dt>Q: What if my database already has quality checked <em>Freesurfer</em> outputs?</dt><dd><p><strong>A:</strong> If you have an already processed and QC-ed freesurfer directory remember to use the flag <code class="docutils literal notranslate"><span class="pre">-freesurfer_dir</span></code> when you run the pipeline!!
It will make a copy of your data with a compatible naming inside <code class="docutils literal notranslate"><span class="pre">out/freesurfer/</span></code>. It’s up to you to keep the original <em>freesurfer</em> directory or erase it.</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">Usage example of -freesurfer_dir flag</span><a class="headerlink" href="#id6" title="Permalink to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span> <span class="c1"># Run micapipe</span>
<span class="linenos">2</span> mica-pipe -bids rawdata -out derivatives -sub <span class="m">01</span> <span class="se">\</span>
<span class="linenos">3</span>       -proc_freesurfer -freesurfer_dir &lt;path_to_my_subject_freesurfer_dir&gt; <span class="se">\</span>
</pre></div>
</div>
</div>
</dd>
<dt>Q: How do I modify the smoothing on the surfaces?</dt><dd><p><strong>A:</strong> By default micapipe <code class="docutils literal notranslate"><span class="pre">-Morphology</span></code> only applies a smoothing of 10mm over the surfaces.
If you need a different FWHM you can use either: <code class="docutils literal notranslate"><span class="pre">mri_surf2surf</span></code> from <em>freesurfer</em> or <code class="docutils literal notranslate"><span class="pre">wb_command</span> <span class="pre">-metric-smoothing</span></code> from <em>workbench</em>.</p>
<p>In the next examples we’ll use the subject <code class="docutils literal notranslate"><span class="pre">sub-01</span></code> session <code class="docutils literal notranslate"><span class="pre">ses-01</span></code>:</p>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text">20mm smoothing of the left hemisphere using <em>freesurfer</em> tools</span><a class="headerlink" href="#id7" title="Permalink to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span> <span class="c1"># OutDir is the directory with -Morphology outpus</span>
<span class="linenos"> 2</span> <span class="nv">outDir</span><span class="o">=</span>out/micapipe/sub-01/ses01/anat/surfaces/morphology
<span class="linenos"> 3</span>
<span class="linenos"> 4</span> <span class="c1"># Declare the micapipe&#39;s freesurfer directory variable</span>
<span class="linenos"> 5</span> <span class="nb">export</span> <span class="nv">SUBJECTS_DIR</span><span class="o">=</span>out/freesurfer
<span class="linenos"> 6</span>
<span class="linenos"> 7</span> mri_surf2surf --hemi lh <span class="se">\</span>
<span class="linenos"> 8</span>     --fwhm-trg <span class="m">20</span> <span class="se">\</span>
<span class="linenos"> 9</span>     --srcsubject sub-01_ses01 <span class="se">\</span>
<span class="linenos">10</span>     --srcsurfval <span class="s2">&quot;</span><span class="si">${</span><span class="nv">outDir</span><span class="si">}</span><span class="s2">/sub-01_ses01_space-fsnative_desc-lh_thickness.mgh&quot;</span> <span class="se">\</span>
<span class="linenos">11</span>     --trgsubject fsaverage5 <span class="se">\</span>
<span class="linenos">12</span>     --trgsurfval <span class="s2">&quot;</span><span class="si">${</span><span class="nv">outDir</span><span class="si">}</span><span class="s2">/sub-01_ses01_space-fsaverage5_desc-lh_thickness_20mm.mgh&quot;</span>
<span class="linenos">13</span>     <span class="s2">&quot;</span><span class="si">${</span><span class="nv">outDir</span><span class="si">}</span><span class="s2">/lh_curv_20mm_c69-32k.func.gii&quot;</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text">20mm smoothing of the left hemisphere using <em>WorkBench</em> tools</span><a class="headerlink" href="#id8" title="Permalink to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="nv">MICAPIPE_DIR</span><span class="o">=</span>&lt;path to the micapipe repository&gt;
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="c1"># For WorkBench the first step is to convent the mgh surface file to GIFTI</span>
<span class="linenos"> 4</span> mri_convert <span class="s2">&quot;</span><span class="si">${</span><span class="nv">outDir</span><span class="si">}</span><span class="s2">/sub-01_ses01_space-conte69-32k_desc-lh_thickness.mgh&quot;</span> <span class="s2">&quot;/tmp/lh_curv_c69-32k_thickness.func.gii&quot;</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span> wb_command -metric-smoothing <span class="se">\</span>
<span class="linenos"> 7</span>     <span class="s2">&quot;</span><span class="si">${</span><span class="nv">MICAPIPE_DIR</span><span class="si">}</span><span class="s2">/surfaces/fsaverage.L.midthickness_orig.32k_fs_LR.surf.gii&quot;</span> <span class="se">\</span>
<span class="linenos"> 8</span>     <span class="s2">&quot;/tmp/lh_curv_c69-32k_thickness.func.gii&quot;</span> <span class="se">\</span>
<span class="linenos"> 9</span>     <span class="m">20</span> <span class="se">\</span>
<span class="linenos">10</span>     <span class="s2">&quot;/tmp/lh_curv_20mm_c69-32k.func.gii&quot;</span>     <span class="c1"># This is the 20 mm FWHM surface</span>
<span class="linenos">11</span>
<span class="linenos">12</span> <span class="c1"># Convert from GIFTI back to MGH</span>
<span class="linenos">13</span> mri_convert <span class="s2">&quot;/tmp/lh_curv_10mm_c69-32k.func.gii&quot;</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">outDir</span><span class="si">}</span><span class="s2">/sub-01_ses01_space-conte69-32k_desc-lh_thickness_20mm.mgh&quot;</span>
</pre></div>
</div>
</div>
</dd>
</dl>
</section>
<section id="resting-state-issues">
<h2><a class="toc-backref" href="#id14">Resting state issues</a><a class="headerlink" href="#resting-state-issues" title="Permalink to this heading"></a></h2>
<dl>
<dt>Q: How do I process multiple rsfMRI If I have different runs in the same session?</dt><dd><p><strong>A:</strong> Right now the pipeline does not manage multiple runs on the same session.
We recommend to concatenate all the runs into one file and process it.
Using <code class="docutils literal notranslate"><span class="pre">mrcat</span></code> from MRtrix3 for example:</p>
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text">Concatenates all rsfMRI runs and process the output</span><a class="headerlink" href="#id9" title="Permalink to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span> <span class="c1"># Inside the func directory contatenate all the runs</span>
<span class="linenos">2</span> mrcat sub-01_task-rest_run-1_bold.nii.gz sub-01_task-rest_run-2_bold.nii.gz sub-01_task-rest_desc-cat_bold.nii.gz
<span class="linenos">3</span>
<span class="linenos">4</span> <span class="c1"># Copy the json file from run-1</span>
<span class="linenos">5</span> cp sub-01_task-rest_run-1_bold.json sub-01_task-rest_desc-cat_bold.json
<span class="linenos">6</span>
<span class="linenos">7</span> <span class="c1"># Run micapipe and specify the name of the concatenated rsfmri</span>
<span class="linenos">8</span> mica-pipe -bids rawdata -out derivatives -sub <span class="m">01</span> <span class="se">\</span>
<span class="linenos">9</span>       -proc_rsfmri -mainScanStr task-rest_desc-cat_bold <span class="se">\</span>
</pre></div>
</div>
</div>
</dd>
<dt>Q: Can I process multi-echo rsfMRI acquisition with micapipe?</dt><dd><p><strong>A:</strong> Although is planned to be included in a future release, right now <cite>micapipe</cite> cannot handle in any way multi-echo acquisitions.</p>
</dd>
<dt>Q: How do I train an ICA-FIX <code class="docutils literal notranslate"><span class="pre">RData</span></code> file?</dt><dd><p><strong>A:</strong> The default processing of rsfMRI was optimized with the MICs dataset. Thus, we generated a custom training file in order to use FIX with our dataset.
If you want to use FIX to clean the noisy components from your rsfMRI time series, we recommend to train your own weights file using <a class="reference external" href="https://fsl.fmrib.ox.ac.uk/fsl/fslwiki/FIX/UserGuide#Training_datasets">FSL-FIX instructions</a></p>
</dd>
<dt>Q: What if I already have rsfMRI processed data? (eg. from fmriPREP)</dt><dd><p><strong>A:</strong> Unfortunately, due to the multiple nested steps which take place inside <code class="docutils literal notranslate"><span class="pre">proc_rsfmri</span></code> is not possible to use an already processed rsfMRI volume.
If you are thrilled to develop its implementation, please help us!</p>
</dd>
<dt>Q: Why does <cite>micapipe</cite> not apply slice timing correction in rsfMRI processing?</dt><dd><p><strong>A:</strong> <cite>micapipe</cite> was optimized for multi-band acquisitions, which do not require slice timing correction.</p>
</dd>
<dt>Q: If my database has the field maps instead of the reverse phase encoding acquisition of rsfMRI and DWI, can micapipe use them for the geometric distortion correction?</dt><dd><p><strong>A:</strong> The usage of field maps is not implemented in <em>micapipe</em>.
However you could apply the field map based correction to their correspondent images and then run micapipe, choosing the fieldmap-based corrected images to process.</p>
</dd>
</dl>
</section>
<section id="dwi-issues">
<h2><a class="toc-backref" href="#id15">DWI issues</a><a class="headerlink" href="#dwi-issues" title="Permalink to this heading"></a></h2>
<dl>
<dt>Q: What if I already have DWI processed data?</dt><dd><p><strong>A:</strong> If you have your DWI already processed and you don’t want to run this step again. you can use the flag <code class="docutils literal notranslate"><span class="pre">-dwi_processed</span></code> to the processed DWI,
it must be in <code class="docutils literal notranslate"><span class="pre">mif</span></code> format with <em>bvals</em>, <em>bvecs</em>, <em>PhaseEncodingDirection</em> and <em>ReadoutTime</em> encoded.</p>
<div class="literal-block-wrapper docutils container" id="id10">
<div class="code-block-caption"><span class="caption-text">Usage example of -dwi_processed flag</span><a class="headerlink" href="#id10" title="Permalink to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span> <span class="c1"># Run micapipe</span>
<span class="linenos">2</span> mica-pipe -bids rawdata -out derivatives -sub <span class="m">01</span> <span class="se">\</span>
<span class="linenos">3</span>       -proc_dwi -dwi_processed &lt;path&gt;/dwi_preprocessed.mif <span class="se">\</span>
</pre></div>
</div>
</div>
</dd>
<dt>Q: Can I save the tractogram (tck file) generated in <code class="docutils literal notranslate"><span class="pre">-SC</span></code> ?</dt><dd><p><strong>A:</strong> Yes, you need to use the flag <code class="docutils literal notranslate"><span class="pre">-keep_tck</span></code> to keep the connectome generated by the pipeline, which is erased by default.</p>
</dd>
<dt>Q: Does <code class="docutils literal notranslate"><span class="pre">micapipe</span></code> compress the tractogram (tck file) generated in <code class="docutils literal notranslate"><span class="pre">-SC</span></code> when they are saved with <code class="docutils literal notranslate"><span class="pre">-keep_tck</span></code>?</dt><dd><p><strong>A:</strong> No, by default, our pipeline does not save the tractograms or compress them after connectome calculations (<code class="docutils literal notranslate"><span class="pre">-SC</span></code>). The main reason is storage and computational time, which is a significant issue even when compression is used (for 10 million streamlines, uncompressed/compressed tractograms are ~14G/3G per case). When running the pipeline, it is possible to keep tractograms (optional argument <code class="docutils literal notranslate"><span class="pre">-keep_tck</span></code>), but it’s up to the final user to compress them.
We included a short tutorial regarding this issue in the section <a class="reference external" href="../04.tckdownsample/index.html">How to downsample a tractogram</a></p>
</dd>
<dt>Q: My dataset contains multiple and separated DWI shells, can I process them individually or should I merge them before <code class="docutils literal notranslate"><span class="pre">-proc_dwi</span></code>?</dt><dd><p><strong>A:</strong> The default behavior of micapipe is to use all the dwi shells provided and perform a rigid registration before concatenating them. While we found this step to increase robustness of our processing for some cases in the MICs dataset, applying a rotation prior to invoking <code class="docutils literal notranslate"><span class="pre">dwipreproc</span></code> (which runs eddy/topup and thus also corrects for motion within a given <code class="docutils literal notranslate"><span class="pre">mif</span></code> file) may increase data interpolation between shells.
If the user wants to avoid this rigid registration between shells is possible to concatenate the shells prior processing and call the resulting file with their corresponding updated json, bvecs and bval files. We recommend using <code class="docutils literal notranslate"><span class="pre">mrcat</span></code> and <code class="docutils literal notranslate"><span class="pre">mrconvert</span></code> to perform this step.</p>
<p>If the user wants to process only an individual shell from a dataset acquisition is also possible using the flag <code class="docutils literal notranslate"><span class="pre">-dwi_main</span></code> to select only one DWI nifti file.</p>
<p><strong>Processing multiple shells with default parameters</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1"># Path relative to main MICs rawdata directory</span>
<span class="linenos"> 2</span><span class="nv">sub_id</span><span class="o">=</span><span class="s2">&quot;sub-HC001/ses-01/dwi/sub-HC001_ses-01&quot;</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="c1"># Processing command</span>
<span class="linenos"> 5</span>micapipe -sub HC001 -ses <span class="m">01</span> -proc_dwi <span class="se">\</span>
<span class="linenos"> 6</span>  -bids . <span class="se">\</span>
<span class="linenos"> 7</span>  -out ../derivatives <span class="se">\</span>
<span class="linenos"> 8</span>  -dwi_main <span class="si">${</span><span class="nv">sub_id</span><span class="si">}</span>_acq-b2000-91_dir-AP_dwi.nii.gz,<span class="si">${</span><span class="nv">sub_id</span><span class="si">}</span>_acq-b700-41_dir-AP_dwi.nii.gz <span class="se">\</span>
<span class="linenos"> 9</span>  -dwi_rpe <span class="si">${</span><span class="nv">sub_id</span><span class="si">}</span>_dir-PA_dwi.nii.gz <span class="se">\</span>
<span class="linenos">10</span>  -dwi_acq multi-shell
</pre></div>
</div>
<p><strong>Processing a single shell</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1"># Processing command</span>
<span class="linenos">2</span>micapipe -sub HC001 -ses <span class="m">01</span> -proc_dwi <span class="se">\</span>
<span class="linenos">3</span>  -bids . <span class="se">\</span>
<span class="linenos">4</span>  -out ../derivatives <span class="se">\</span>
<span class="linenos">5</span>  -dwi_main <span class="si">${</span><span class="nv">sub_id</span><span class="si">}</span>_acq-b700-41_dir-AP_dwi.nii.gz <span class="se">\</span>
<span class="linenos">6</span>  -dwi_rpe <span class="si">${</span><span class="nv">sub_id</span><span class="si">}</span>_dir-PA_dwi.nii.gz <span class="se">\</span>
<span class="linenos">7</span>  -dwi_acq shell-b700
</pre></div>
</div>
<p><strong>Concatenating shells before processing with micapipe</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1"># From the subject&#39;s DWI directory</span>
<span class="linenos"> 2</span><span class="nb">cd</span> sub-HC001/ses-01/dwi/
<span class="linenos"> 3</span><span class="nv">sub</span><span class="o">=</span><span class="s2">&quot;sub-HC001_ses-01&quot;</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="c1"># Convert each shell to mif to store the associated bvecs, bvals and json files</span>
<span class="linenos"> 6</span><span class="c1"># Shell b2000</span>
<span class="linenos"> 7</span>mrconvert -json_import <span class="si">${</span><span class="nv">sub</span><span class="si">}</span>_acq-b2000-91_dir-AP_dwi.json <span class="se">\</span>
<span class="linenos"> 8</span>-fslgrad <span class="si">${</span><span class="nv">sub</span><span class="si">}</span>_acq-b2000-91_dir-AP_dwi.bvec <span class="si">${</span><span class="nv">sub</span><span class="si">}</span>_acq-b2000-91_dir-AP_dwi.bval <span class="se">\</span>
<span class="linenos"> 9</span><span class="si">${</span><span class="nv">sub</span><span class="si">}</span>_acq-b2000-91_dir-AP_dwi.nii.gz <span class="se">\</span>
<span class="linenos">10</span><span class="si">${</span><span class="nv">sub</span><span class="si">}</span>_acq-b2000-91_dir-AP_dwi.mif
<span class="linenos">11</span>
<span class="linenos">12</span><span class="c1"># Shell b700</span>
<span class="linenos">13</span>mrconvert -json_import <span class="si">${</span><span class="nv">sub</span><span class="si">}</span>_acq-b700-41_dir-AP_dwi.json <span class="se">\</span>
<span class="linenos">14</span>-fslgrad <span class="si">${</span><span class="nv">sub</span><span class="si">}</span>_acq-b700-41_dir-AP_dwi.bvec <span class="si">${</span><span class="nv">sub</span><span class="si">}</span>_acq-b700-41_dir-AP_dwi.bval <span class="se">\</span>
<span class="linenos">15</span><span class="si">${</span><span class="nv">sub</span><span class="si">}</span>_acq-b700-41_dir-AP_dwi.nii.gz <span class="se">\</span>
<span class="linenos">16</span><span class="si">${</span><span class="nv">sub</span><span class="si">}</span>_acq-b700-41_dir-AP_dwi.mif
<span class="linenos">17</span>
<span class="linenos">18</span><span class="c1"># Concatenate shells and export bvec, bval and json files</span>
<span class="linenos">19</span>mrcat <span class="si">${</span><span class="nv">sub</span><span class="si">}</span>_acq-b2000-91_dir-AP_dwi.mif <span class="si">${</span><span class="nv">sub</span><span class="si">}</span>_acq-b700-41_dir-AP_dwi.mif <span class="si">${</span><span class="nv">sub</span><span class="si">}</span>_acq-MultiShell_dir-AP_dwi.mif
<span class="linenos">20</span>
<span class="linenos">21</span><span class="c1"># Convert mif to nifti</span>
<span class="linenos">22</span>mrconvert -export_grad_fsl <span class="si">${</span><span class="nv">sub</span><span class="si">}</span>_acq-MultiShell_dir-AP_dwi.bvec <span class="si">${</span><span class="nv">sub</span><span class="si">}</span>_acq-MultiShell_dir-AP_dwi.bval <span class="se">\</span>
<span class="linenos">23</span>-json_export <span class="si">${</span><span class="nv">sub</span><span class="si">}</span>_acq-MultiShell_dir-AP_dwi.json <span class="se">\</span>
<span class="linenos">24</span><span class="si">${</span><span class="nv">sub</span><span class="si">}</span>_acq-MultiShell_dir-AP_dwi.mif <span class="se">\</span>
<span class="linenos">25</span><span class="si">${</span><span class="nv">sub</span><span class="si">}</span>_acq-MultiShell_dir-AP_dwi.nii.gz
<span class="linenos">26</span>
<span class="linenos">27</span><span class="c1"># Processing command</span>
<span class="linenos">28</span>micapipe -sub HC001 -ses <span class="m">01</span> -proc_dwi <span class="se">\</span>
<span class="linenos">29</span>-bids <span class="se">\</span>
<span class="linenos">30</span>-out <span class="se">\</span>
<span class="linenos">31</span>-dwi_main <span class="si">${</span><span class="nv">sub</span><span class="si">}</span>_acq-MultiShell_dir-AP_dwi.nii.gz <span class="se">\</span>
<span class="linenos">32</span>-dwi_rpe <span class="si">${</span><span class="nv">sub</span><span class="si">}</span>_dir-PA_dwi.nii.gz
<span class="linenos">33</span>-dwi_acq MultiShell
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="parcellation-issues">
<h2><a class="toc-backref" href="#id16">Parcellation issues</a><a class="headerlink" href="#parcellation-issues" title="Permalink to this heading"></a></h2>
<dl class="simple">
<dt>Q: Can I use a different cortical / subcortical / cerebellar atlas not included in the micapipe?</dt><dd><p><strong>A:</strong> At the present moment this feature is not included. If you wan’t to help us implementing this new feature you are very welcome.</p>
</dd>
</dl>
</section>
</section>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../06.citingmicapipe/index.html" class="btn btn-neutral float-right" title="Citing micapipe" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../04.tckdownsample/index.html" class="btn btn-neutral float-left" title="How to downsample a tractogram" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2022, micapipe

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a 
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a> and modified by SL and RRC 

</footer>

        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>  

  <style>
         .wy-nav-content { max-width: none; }
  </style>


  <footer>
    
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a 
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. Modified by SL 🤠 

  </footer>



</body>
</html>